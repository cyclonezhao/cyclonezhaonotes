---
layout: post
title:  "java代码速查"
---

# 文件操作

Q: 文件重命名、移动

```java
String fmt = "%s%s%s.xlsx";
String fullname = String.format(fmt, dir, File.separator, index++);
jpg.renameTo(new File(fullname));
```

Q: 目录下的文件

```java
File parent = new File(dir);
File[] subDirs = parent.listFiles();
```

Q: 文件读取

```java
String fileName = "d:\\bbbbb";
FileInputStream fis = new FileInputStream(fileName);
InputStreamReader isr = new InputStreamReader(fis, "UTF-8");
BufferedReader br = null;
try{
    br = new BufferedReader(isr);
    while ((line = br.readLine()) != null) {

    }
}finally{
    br.close();
}
```

Q: 文件写入

```java
// 必须要有目录，不然下面的写文件会失败
File file = new File("d:\\perf");
if(!file.exists()){
	file.mkdir();
}

// 构造器 FileWriter 的第二个参数若为true，则可追加写入
try(BufferedWriter out = new BufferedWriter(new FileWriter("d:\\perf\\runoob.txt"))){
	out.write("kkkkk");
}catch(Exception exception ){
	System.out.println();
}
```

# 正则

Q: 包含匹配

```java
String pattern = "\\d\\d:\\d\\d:\\d\\d \\[.+?\\]";
Pattern r = Pattern.compile(pattern);
Matcher m = r.matcher(line);
if(m.find()){
```

Q: 匹配替换

```java
// 将连续的两个以上空格替换为1个空格
String sql = "INSERT INTO XXXXX(AA,BB  ,CC,DD, EE, FF)VALUES(?,?,?,?,?,?)";
sql = sql.replaceAll("\\s{2,}", " ");
```

Q: 捕获

```java
Pattern pattern = Pattern.compile("insert into (\\w+)\\s?\\((.+?)\\)\\s?values", Pattern.CASE_INSENSITIVE);
Matcher matcher = pattern.matcher(sql);
if(matcher.find()){ // 或者 while(matcher.find())，如果有多个匹配的话
    int groupCount = matcher.groupCount();
    String tableName = matcher.group(1);
    String fieldStr = matcher.group(2);
```

# 随机数

Q: 返回[0,k)之间的随机整数

```java
public static int kRandom(int k) {
    double rawRandom = Math.random();
    rawRandom = (double) k * rawRandom;
    return Double.valueOf(Math.floor(rawRandom)).intValue();
}
```

Q: 返回n个[0,k)之间的随机整数

```java
public static int[] nkRandom(int n, int k, boolean distinct) {
    Collection<Integer> col = null;
    col = distinct ? new HashSet() : new ArrayList();
    while (col.size() < n) {
        int val = Util.kRandom(k);
        col.add(val);
    }
    return col.stream().mapToInt(Integer::valueOf).toArray();
}
```

# 图片处理

Q: 给指定目录下的图片加上边框。

```java
package javaProjectTest;
import java.awt.BasicStroke;
import java.awt.Color;
import java.awt.Graphics2D;
import java.awt.image.BufferedImage;
import java.io.File;
import java.util.List;
import java.util.stream.Collectors;
import java.util.stream.Stream;

import javax.imageio.ImageIO;

public class ImageBorder {

	/**
	 * 输入目录，把目录下的所有图片加上边框。
	 * @param args
	 */
    public static void main(String[] args) {
    	try {
    		String dir = args[0];
    		ImageBorder imageBorder = new ImageBorder();
    		imageBorder.exec(dir);
		} catch (Exception e) {
			e.printStackTrace();
		}
    }

	private void exec(String dir) throws Exception{
		File parent = new File(dir);
		File[] subFileArr = parent.listFiles();
		// 按最后修改时间排序，使得加边框后的图片排序和处理前一致。
		List<File> subFiles = Stream.of(subFileArr).sorted((v1,v2)->Long.valueOf(v1.lastModified()-v2.lastModified()).intValue()).collect(Collectors.toList());
		int i = 0;
		for (File file : subFiles) {
			addBorder(file.getAbsolutePath(), i);
			i++;
		}
	}

	private void addBorder(String imageFullPath, int index) throws Exception {
		BufferedImage myPicture = ImageIO.read(new File(imageFullPath));
		
		int width = myPicture.getWidth();
		int height = myPicture.getHeight();
		Graphics2D g = (Graphics2D) myPicture.getGraphics();
		g.setStroke(new BasicStroke(1));
		float[] rgBtoHSB = Color.RGBtoHSB(170,170,170, new float[3]);
		Color borderColor = Color.getHSBColor(rgBtoHSB[0], rgBtoHSB[1], rgBtoHSB[2]);
		g.setColor(borderColor);
		g.drawRect(0, 0, width-1, height-1);
		
		// 不知为何，第二个参数如果是jpg，输出的图像就是几乎全黑
		ImageIO.write(myPicture, "png", new File(imageFullPath));
	}
}
```