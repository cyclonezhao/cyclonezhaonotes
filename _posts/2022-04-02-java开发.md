---
layout: post
title:  "java开发"
---

# 网络

Q: 发起http请求

**创建HttpURLConnection**

```java
// 输入：url
HttpURLConnection con = null;
URL u = new URL(url);
// 判断是否走代理
ProxyAddr httpProxy = getHttpProxy();
if(httpProxy != null) {
    InetSocketAddress addr = new InetSocketAddress(httpProxy.hostname, httpProxy.port);
    Proxy proxy = new Proxy(Proxy.Type.HTTP, addr);
    con = (HttpURLConnection)u.openConnection(proxy);
} else {
    con = (HttpURLConnection)u.openConnection();
}
con.setConnectTimeout(connectTimeout);
con.setReadTimeout(socketTimeout);
return con;
```

**对HttpURLConnection根据实际情况做一些设置**

```java
con.setRequestProperty("Content-type", "application/json");
con.setRequestMethod("POST");
con.setDoOutput(true);
con.setDoInput(true);
```

**输入请求数据**

```java
connOutputStream = con.getOutputStream();
writer = new BufferedWriter(new OutputStreamWriter(connOutputStream));
writer.write(bodyJson);
writer.flush();
```

**获取响应数据**

```java
connInputStrem = con.getInputStream();
in = new InputStreamReader(connInputStrem, StandardCharsets.UTF_8);
bfreader = new BufferedReader(in);
StringBuffer sb = new StringBuffer();
String line = "";
while ((line = bfreader.readLine()) != null) {
	sb.append(line);
}
String response = sb.toString();
```

**可能抛出的异常**

1. java.net.SocketException: Unexpected end of file from server
   可能和超过了网关或代理设置的超时时间有关
1. java.net.UnknownHostException: xxx.com
   猜测和网关的dns解析异常有关
1. javax.net.ssl.SSLHandshakeException: Remote host closed connection during handshake
   ![SSLHandshakeException](image/java开发/SSLHandshakeException.jpg)